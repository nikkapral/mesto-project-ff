(()=>{"use strict";var e="",t="8889e354-a6c3-4f31-a2cd-67459861e962",n="https://mesto.nomoreparties.co/v1/".concat("web-magistracy-2");function r(e){return e.ok?e.json():e.json().catch(function(){return{}}).then(function(t){return Promise.reject({status:e.status,body:t})})}var o=document.querySelector("#card-template");function a(e,t){t.textContent=Array.isArray(e)?e.length:0}function c(e,o,c){var i,u=o.classList.contains("card__like-button_is-active");(u?(i=e._id,fetch("".concat(n,"/cards/likes/").concat(i),{method:"DELETE",headers:{authorization:t}}).then(r)):function(e){return fetch("".concat(n,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:t}}).then(r)}(e._id)).then(function(t){o.classList.toggle("card__like-button_is-active",!u),a(t.likes,c),e.likes=t.likes}).catch(function(e){return console.error(u?"Ошибка снятия лайка:":"Ошибка постановки лайка:",e)})}function i(e,t,n,r,c){var i=o.content.querySelector(".card").cloneNode(!0),u=i.querySelector(".card__image"),l=i.querySelector(".card__delete-button"),s=i.querySelector(".card__title"),d=i.querySelector(".card__like-button"),p=i.querySelector(".card__like-count");return u.src=e.link,u.alt=e.name,s.textContent=e.name,a(e.likes,p),e.owner&&e.owner._id===t||(l.style.display="none"),Array.isArray(e.likes)&&e.likes.some(function(e){return e._id===t})&&d.classList.add("card__like-button_is-active"),l.addEventListener("click",function(t){t.preventDefault(),"function"==typeof n&&n(e._id,i)}),d.addEventListener("click",function(){r(e,d,p)}),u.addEventListener("click",function(){"function"==typeof c&&c(e.link,e.name)}),i}var u=!1;function l(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&d(t)}}function s(e){e.classList.add("popup_is-opened"),u||(document.addEventListener("keydown",l),u=!0)}function d(e){e.classList.remove("popup_is-opened"),!document.querySelector(".popup_is-opened")&&u&&(document.removeEventListener("keydown",l),u=!1)}function p(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));r&&(t.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass))}function f(e,t,n){t&&(function(e){return e.some(function(e){return!e.validity.valid})}(e)?(t.classList.add(n.inactiveButtonClass),t.disabled=!0):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1))}function y(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach(function(n){return p(e,n,t)}),f(n,r,t)}const m=e+"fc3e6875d825f899a98d.svg",_=e+"6666407ac3aa5af1d5de.jpg";function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};document.querySelector(".header__logo").src=m;var b=document.querySelector(".profile__image");b.style.backgroundImage="url(".concat(_,")");var S=document.querySelector(".profile__avatar-edit-button");S&&S.remove();var q,k=document.querySelector(".places__list"),C=document.querySelector(".popup_type_image"),E=C.querySelector(".popup__image"),L=C.querySelector(".popup__caption"),g=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),x=document.querySelector(".popup_type_edit"),j=x.querySelector(".popup__form"),T=j.querySelector("#popup__profile-name"),w=j.querySelector("#popup__profile-job"),z=document.querySelector(".popup_type_new-card"),D=z.querySelector(".popup__form"),B=D.querySelector("#popup__card-name"),I=D.querySelector("#popup__card-url"),O=document.querySelector(".popup_type_edit-avatar"),M=O.querySelector(".popup__form"),P=M.querySelector("#popup__avatar-url"),N=document.querySelector(".popup_type_confirm-delete"),H=N.querySelector(".popup__form"),J=H.querySelector(".popup__button"),U=document.querySelector(".profile__edit-button"),V=document.querySelector(".profile__add-button"),$=document.getElementById("profileAvatar"),F=null,G=null,K=null;function Q(e,t){E.src=e,E.alt=t,L.textContent=t,s(C)}function R(){M.reset(),y(M,h),s(O)}function W(e,t){F=e,K=t,J.textContent="Да",J.disabled=!1,s(N)}function X(e,t){e&&(e.textContent=t)}H.addEventListener("submit",function(e){var o;e.preventDefault(),F&&K?(J.textContent="Удаление...",J.disabled=!0,(o=F,fetch("".concat(n,"/cards/").concat(o),{method:"DELETE",headers:{authorization:t}}).then(r)).then(function(){var e;(e=K)&&e.remove&&e.remove(),d(N),F=null,K=null,J.disabled=!1}).catch(function(e){console.error("Ошибка удаления карточки: ".concat(e)),J.disabled=!1}).finally(function(){J.textContent="Да"})):d(N)}),document.querySelectorAll(".popup").forEach(function(e){return e.classList.add("popup_is-animated")}),U.addEventListener("click",function(){T.value=g.textContent,w.value=A.textContent,y(j,h),s(x)}),V.addEventListener("click",function(){D.reset(),y(D,h),s(z)}),$.addEventListener("click",R),$.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),R())}),j.addEventListener("submit",function(e){e.preventDefault();var o,a,c,i=e.submitter||j.querySelector('button[type="submit"]'),u=i.textContent;i.disabled=!0,X(i,"Сохранение..."),(o={name:T.value.trim(),about:w.value.trim()},a=o.name,c=o.about,fetch("".concat(n,"/users/me"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:a,about:c})}).then(r)).then(function(e){g.textContent=e.name,A.textContent=e.about,d(x),i.disabled=!1}).catch(function(e){console.error("Ошибка обновления профиля: ".concat(e)),i.disabled=!1}).finally(function(){X(i,u)})}),D.addEventListener("submit",function(e){e.preventDefault();var o,a,u,l=e.submitter||D.querySelector('button[type="submit"]'),s=l.textContent;l.disabled=!0,X(l,"Сохранение..."),(o={name:B.value.trim(),link:I.value.trim()},a=o.name,u=o.link,fetch("".concat(n,"/cards"),{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:a,link:u})}).then(r)).then(function(e){var t=i(e,G,W,c,Q);k.prepend(t),D.reset(),d(z),l.disabled=!1}).catch(function(e){console.error("Ошибка добавления карточки: ".concat(e)),l.disabled=!1}).finally(function(){X(l,s)})}),M.addEventListener("submit",function(e){e.preventDefault();var o,a=e.submitter||M.querySelector('button[type="submit"]'),c=a.textContent;a.disabled=!0,X(a,"Сохранение..."),(o=P.value.trim(),fetch("".concat(n,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:o})}).then(r)).then(function(e){b.style.backgroundImage="url(".concat(e.avatar,")"),d(O),M.reset(),a.disabled=!1}).catch(function(e){console.error("Ошибка обновления аватара: ".concat(e)),a.disabled=!1}).finally(function(){X(a,c)})}),document.querySelectorAll(".popup").forEach(function(e){e.querySelector(".popup__close").addEventListener("click",function(){return d(e)}),e.addEventListener("click",function(t){t.target===e&&d(e)})}),Promise.all([fetch("".concat(n,"/users/me"),{headers:{authorization:t}}).then(r),fetch("".concat(n,"/cards"),{headers:{authorization:t}}).then(r)]).then(function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];G=o._id,g.textContent=o.name,A.textContent=o.about,b.style.backgroundImage="url(".concat(o.avatar,")"),k.innerHTML="",a.forEach(function(e){var t=i(e,G,W,c,Q);k.appendChild(t)})}).catch(function(e){return console.error("Ошибка загрузки данных: ".concat(e))}),q=h,Array.from(document.querySelectorAll(q.formSelector)).forEach(function(e){return function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);f(n,r,t),n.forEach(function(o){var a=function(){!function(e,t,n){if(t.setCustomValidity(""),t.validity.patternMismatch&&t.hasAttribute("pattern")){var r=t.dataset.patternMessage||t.validationMessage;t.setCustomValidity(r)}t.validity.valid?p(e,t,n):function(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));r&&(t.classList.add(n.inputErrorClass),r.textContent=t.validationMessage,r.classList.add(n.errorClass))}(e,t,n)}(e,o,t),f(n,r,t)};o.addEventListener("input",a),o.addEventListener("blur",a)})}(e,q)})})();